#!/bin/bash
# {EXPERIMENT_NAME} - Run Script
# ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚¿ã‚¹ã‚¯ã‚’å‰²ã‚Šå½“ã¦ã¾ã™

set -e

SESSION_NAME="{EXPERIMENT_ID}"
AGENT_COUNT={AGENT_COUNT}

echo "Running {EXPERIMENT_ID}..."
echo "Agent count: $AGENT_COUNT"
echo ""

# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
if ! tmux has-session -t "$SESSION_NAME" 2>/dev/null; then
  echo "âŒ Error: Session '$SESSION_NAME' not found"
  echo "   Please run ./setup.sh first"
  exit 1
fi

# å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚¿ã‚¹ã‚¯ã‚’é€ä¿¡
# ã“ã“ã«å®Ÿé¨“å†…å®¹ã«å¿œã˜ãŸæŒ‡ç¤ºã‚’è¨˜è¿°

case $AGENT_COUNT in
  2)
    echo "ğŸ“¤ Sending task to Agent 1 (pane 0.1)..."
    tmux send-keys -t "$SESSION_NAME:0.1" "{TASK_AGENT_1}" Enter
    sleep 2
    tmux send-keys -t "$SESSION_NAME:0.1" Enter
    ;;
  3)
    echo "ğŸ“¤ Sending task to Agent 1 (pane 0.1)..."
    tmux send-keys -t "$SESSION_NAME:0.1" "{TASK_AGENT_1}" Enter
    sleep 2
    tmux send-keys -t "$SESSION_NAME:0.1" Enter

    echo "ğŸ“¤ Sending task to Agent 2 (pane 0.2)..."
    tmux send-keys -t "$SESSION_NAME:0.2" "{TASK_AGENT_2}" Enter
    sleep 2
    tmux send-keys -t "$SESSION_NAME:0.2" Enter
    ;;
  *)
    echo "ğŸ“¤ Sending tasks to $AGENT_COUNT agents..."
    for ((i=1; i<$AGENT_COUNT; i++)); do
      echo "   Agent $i (pane 0.$i)..."
      tmux send-keys -t "$SESSION_NAME:0.$i" "{TASK_AGENT_$i}" Enter
      sleep 2
      tmux send-keys -t "$SESSION_NAME:0.$i" Enter
    done
    ;;
esac

echo ""
echo "âœ… Tasks sent to all agents!"
echo ""
echo "Monitor progress:"
echo "  tmux attach -t $SESSION_NAME"
echo ""
echo "Check results:"
echo "  ls results/"
echo ""
